<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:sftp="http://www.mulesoft.org/schema/mule/sftp"
      xmlns:ftpserver="http://www.mulesoft.org/schema/mule/ftpserver"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:munit="http://www.mulesoft.org/schema/mule/munit"
      xmlns="http://www.mulesoft.org/schema/mule/core"
      xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
      xsi:schemaLocation="
			http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
			http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd
			http://www.mulesoft.org/schema/mule/sftp http://www.mulesoft.org/schema/mule/sftp/current/mule-sftp.xsd
			http://www.mulesoft.org/schema/mule/ftpserver http://www.mulesoft.org/schema/mule/ftpserver/current/mule-ftpserver.xsd">
    <munit:config name="transactions-test-suite.xml"/>
    <ftpserver:config name="MUnit_Invoice_SFTP_Server_Config" doc:name="MUnit Invoice SFTP Server Config"
                      doc:id="a6754d65-368a-4ccc-bf73-48848e8f5668">
        <ftpserver:connection port="${invoice.sftp.port}" username="${invoice.sftp.user}"
                              password="${invoice.sftp.password}" secure="true" homeDir="${app.home}"/>
    </ftpserver:config>
    <sftp:config name="Invoice_SFTP_Config" doc:name="SFTP Config" doc:id="ec381f6a-57bc-4adf-9d94-827c1237223a">
        <sftp:connection host="${invoice.sftp.host}" port="${invoice.sftp.port}" username="${invoice.sftp.user}"
                         password="${invoice.sftp.password}" workingDir="${invoice.sftp.path}"/>
    </sftp:config>
    <munit:test name="transactions-test-suite" description="Transactions Test"
                doc:id="e1db564b-50f5-46d3-abfc-9e66b840ae63">
        <munit:execution>
            <sftp:write config-ref="Invoice_SFTP_Config" doc:name="Write" doc:id="9b4141a4-9981-4a2c-8949-68cde49c123b"
                        path="invoice_29.xml">
                <sftp:content><![CDATA[#[%dw 2.0
output application/xml
---
invoice: {
	id: 29,
	transactionId: "2514-234x-df23-35fa",
	description: "Important things",
	amount: 999.99
}]]]></sftp:content>
            </sftp:write>
            <sftp:list doc:name="List" doc:id="adcc731b-622c-4bb0-af0e-a7f41efa48fd" config-ref="Invoice_SFTP_Config"
                       directoryPath="/">
                <sftp:matcher
                        filenamePattern="invoice_*.xml"/>
            </sftp:list>
            <foreach doc:name="For Each" doc:id="0ace7dd9-64b8-499b-8a5f-638079711276" collection="#[payload]">
                <logger level="INFO" doc:name="Logger" doc:id="80b0f0e2-97ef-4976-ba46-ed72942d7ecb" message=""/>
            </foreach>
        </munit:execution>
    </munit:test>
</mule>
